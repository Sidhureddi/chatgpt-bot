import os, sys, asyncio
from re_gpt import AsyncChatGPT
from dotenv import load_dotenv

load_dotenv()

session_token ="eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..YozxpPUSR5Cb_sKK.llpQSOfz2H54_wt23-np6bvqB2ZbzgCdPtZOdPIec5d4-009Mimnr9ZRp8j8HqUBq4P8eNwHdPKQmzQHW8FLMOBxUVwcs3wS6Yi5FbQEGCu7-i3U-913nA_B9Kkv16vpqwCu-OXf3gwPDFnwUhJh6KDh_dMf8dX_bner3bKrZDMCOIK0dYthTAdEOujoPpOat2r8_NfWMrVXqYNS8CIOF1A1LhRvWQTatGvlbMgGjjZaQgh9H1UOhUz3XL-FqfxsdRK6QvrazQw9tics_4-XdF5diu4OFmLgJaZrmlD1A0dVCw29jg_QNDlAT_0aTcifkD6ah_rL1rbDY7ZdP6QK-MozvjvuRrJ9LKsQOJRfBWAnSeayKJdiblyOdr-1oniFin32t0NzfiSPPZ0nhn57fo_EftGZTxqeYZVcWnAp02KeCng3U9khYUe4o8qS_Z-ESK9D5gQAgA2PqdqfmA595f6GjtrHParDLZMtgOmuVME-vVd4QlchWqpM2_usuhYwev6Y9lG01Ikwax1yGnwnvJv1A_mvx_9spebvJqGGZyFydpYC16hz68yez5uATwjH99bKqTNNS1rPMfdoPdo4r16Q8buHiQj1xHIuITHXDsko40nm43QFXQ2Q9A7k5Y6gA5Mrqvbzo3-IK_ZDdwqI4SQ6f6Hn93QCQ79FsQ5_Obl5w1p_YJrDEY5XwA1Cex5Sd5TnXQX-APKUxw-NssqDsl5veG41jOxRyLmGWOEfrnprI5TtJD47sJF2nOFCybrKtdDq3_4H8nuYakzlRQTc7hBtq0JZHwmSoMWpMZMhpklT7emeek2Nhx6TZm7NHGFw_-5cvOarUvOdWCyIWz7ncdplf8vMHBAnLjWxTGh8wWmzqGmwQwZGBhEkpklQIsN-HKbL2hHr1pB9Kvksoi7tbEsWdVk681LHhFIUl9AWh7ktYsfg9G6dbLZOX7eYFJ5RAy5cx5NraMzKmShf6ve3H6Q3D9JxzMFoy_upB0MxXqTqTY8JGfRoJIWIKEi_JesiQc4Z9BHltZj0K2QuU6-eGM1nbbJA5NU9nXDzMjYr-H9AWmwNc1IKodequWWI1Nv-qW_tKaS_5HFj1XrwX0wG1wOKwMV1_2KJwK12Y9FaLaLO4twed5NDvc-zO0Gf17pEHSiLwHYB3SvmjxzFZiw-cKDBdNK6V49HlpmTLPj__VXWWHPQp8fHeWenkS34XjTlLYkNrnjKYPnFgzHz9fQpoHoFMFhTf5M3Eeo45f8R6C4NjcqOXqMQYqOPs6PtxahBqbSOrKOf3bXHomUP2nheN5YOnLCnQhoU_Uw9uTxoJGoQBPPLQxIy5BHH4Cp4zQ9hRJgKLTdYS4YeAHYijh6RpFQ3rNaS0ApLa61nbFBifhkjYNMyUtuvGNovZV1ir0m8PqW1UBw2_9luuLLqs6AMWxiGKCSXwOK4VoHKBZzdZaA7GzG2zFA42X7U3xuWm-vQavy6FjMF9eWl18gyU5HcHTi3MxobTRBiUGfpbZOqBXlcpuzuIeKPmtspwC-hIgL65qDV0ly-wvPx5o1hV7zeCHlGzvLKy1Voy71OrXWzdz0RVN_hqd5INFqmcUhhoDnuS6RXvJGP0fqPbGLAnUVs85C9Du9xq4ss7KtNSToYMbEPoTPFUmE5qjpFEOVUsfYOg3gDXDN32ano0JL9tJ4oC3uoRoLd7c9qNFjIOJoBmLyy7ikXiPy8N1deVkieyc1KZYCYvDGnuKUE0HUu6QPiaKV-L52WZEJo4qj5k8nG-VrLNIyUZhK0R7ur00EE4kZTp9Sq_v7G1jqBqi-BDgxVPytdXnnxrQk3g6_X4wd1sW5IZ9WqrnhFoGE4a1Ss7mxubAhus3DmdF4YV75nn25DTgRXXtScDJGB-EJ37NjlvrdAcynCVap8862Q-e3xC6hD2UscbOmVsnW3DZ4YiYLC5fSGU1XUIEN2Nw8QN5V8XeQYhdWa-VU8nAkaW9jogJUnfVA1N0vmldEpOJzpWENTf87wr0_-E2Bw61xZEXTBVk3juHXe89U6DY9knzPBaBjs_Gv1PxtJqH6tQEyNiyklnAvJSbVSlBKUFzfCR-th-nSyFNKs3wIRrPE-Njyx2Rt6nxz0M_SpK61e_kyab032o9CnKOFdE5sYAcjJafN_UYiYg1J3ZoVqdq1-IdtnbsORUh0KQFsbGQdSGfzbSTZ8CK6Q8rO3FbTwSwWnMUP2vLDRdEAQzr4KzaD9mHJuGsY5kgEPfYLaj_QiSrUnoZvP32dFhdlXBuuJEZiUiRu9wYq56wBUslSgZMTtbmm2z-7J-FQPFauN0qSMFkDF5wzG4jH-uOf55ZkTTN4CNVDQF6eaJ7XLvUldenMckzKeltYyeErwGlB2hj5N8-HEvak8m2hdSZwqMCSuFwuuRdwgrTnkbA8vTVH8DlIKZjJOAcX3COYVdIFGhBFcw0Af2oFaDVb-tNLf6KTDfpvkdE-gGQJXVhCOrItmRMY5L7LrrixiM-P_hKcMB23CPsRtRnjb0hxTgM2GmRXthE1Bk_y0aG9glS5SMFjvBuQZ7DxQv7X8o5ydQDqMM2ubiVVykmpUr18bTiAUap7LhUEArRDvrky0nVAPnGLU9c3DYkZnzj94clgs8CmHb78q4h21nThp9LTyuNlS7q0Ay22Rl9sgx1BZLqrvnYzn9Bts4iRV8a8c0Iw3_c8pmvLbZWXLu3MwICCfC1Kx2Mup92fq0xwFpcVU3UnR5MzjDiE7s2lLIYZa7hST8quU0DaFQOFptzjXCDiyDfw64jS9j_b2gH8m9gl3M3UQRwOAKluNwQhQY3X_wxq3y-s_UGLoC6EopDEK1LkWjljhuoVJ5wT7KWSXa6r4tJrq.uNTIhLZOtYx-NhM0IR0fdg"

if sys.version_info >= (3, 8) and sys.platform.lower().startswith("win"):
    asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
    

async def chatgpt() -> AsyncChatGPT:
    return await AsyncChatGPT(session_token=session_token).__aenter__()


async def generate_response(conversation, prompt: str):
    pending_response = ""
    # yield streaming response
    async for message in conversation.chat(prompt):
        pending_response += message['content']
        if pending_response and len(pending_response) > 100:
            yield pending_response
            pending_response = ""
    if pending_response:
        yield pending_response
